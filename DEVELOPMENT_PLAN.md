# Chtholly项目开发计划

## 项目原则

1. **TDD驱动**: 先写测试，再实现功能
2. **稳定为主**: 确保每个功能完整实现后再推进下一个
3. **避免占位**: 不实现占位功能，要么完整实现，要么不实现
4. **避免回归**: 新功能不能破坏已有功能
5. **认真对待**: 即使是学习项目也要保证质量

## 开发阶段

### 第一阶段：基础语法（当前）

优先级：⭐⭐⭐⭐⭐

#### 1.1 注释系统 ✅
- [x] 行注释 `//`
- [x] 块注释 `/* */`
- [ ] 生成器注释 `# `（需要完善）

**测试要求**:
```cpp
TEST_CASE("Comments are parsed correctly") {
    // 测试 // 注释
    // 测试 /* */ 注释
    // 测试 # 注释
    // 测试注释不会出现在生成的HTML中（除了生成器注释）
}
```

#### 1.2 文本节点 ✅
- [x] `text { "内容" }` 形式
- [ ] `text: "内容";` 属性形式
- [ ] 无修饰字面量支持

**测试要求**:
```cpp
TEST_CASE("Text nodes generate correct HTML") {
    // text { "hello" } -> "hello"
    // text: "hello"; -> "hello"
    // text { hello } -> "hello" (无修饰字面量)
}
```

#### 1.3 元素节点 ✅
- [x] 基础元素解析
- [ ] 元素嵌套
- [ ] 属性解析（id, class等）
- [ ] 单标签处理

**测试要求**:
```cpp
TEST_CASE("Elements with attributes") {
    // div { id: box; class: main; }
    // -> <div id="box" class="main"></div>
}

TEST_CASE("Nested elements") {
    // div { span { } }
    // -> <div><span></span></div>
}
```

#### 1.4 CE对等式
- [ ] `:` 和 `=` 完全等价

**测试要求**:
```cpp
TEST_CASE("Colon equals Equal") {
    // id: box; 等同于 id = box;
}
```

### 第二阶段：样式系统

优先级：⭐⭐⭐⭐

#### 2.1 内联样式
- [ ] 基础CSS属性
- [ ] style块解析

**测试要求**:
```cpp
TEST_CASE("Inline styles") {
    // div { style { width: 100px; } }
    // -> <div style="width: 100px;"></div>
}
```

#### 2.2 自动化类名/ID
- [ ] `.box` 自动添加class
- [ ] `#box` 自动添加id
- [ ] 提取到全局样式块

**测试要求**:
```cpp
TEST_CASE("Auto class/id") {
    // div { style { .box { width: 100px; } } }
    // -> <div class="box"></div>
    // -> <style>.box { width: 100px; }</style>
}
```

#### 2.3 上下文推导
- [ ] `&` 引用选择器
- [ ] `&:hover` 伪类
- [ ] `&::before` 伪元素

#### 2.4 属性运算
- [ ] 基础运算符 `+ - * / % **`
- [ ] 单位合并
- [ ] 左结合规则

**测试要求**:
```cpp
TEST_CASE("CSS arithmetic") {
    // width: 100px + 50px; -> width: 150px;
    // width: 100px * 2; -> width: 200px;
}
```

### 第三阶段：模板系统

优先级：⭐⭐⭐

#### 3.1 样式组模板
- [ ] `[Template] @Style` 定义
- [ ] 使用 `@Style Name;`

#### 3.2 元素模板
- [ ] `[Template] @Element` 定义
- [ ] 使用 `@Element Name;`

#### 3.3 变量组模板
- [ ] `[Template] @Var` 定义
- [ ] 使用 `VarGroup(varName)`

#### 3.4 继承系统
- [ ] 组合继承
- [ ] 显性继承 `inherit`

### 第四阶段：自定义系统

优先级：⭐⭐⭐

#### 4.1 自定义样式组
- [ ] 无值样式组
- [ ] 特例化操作
- [ ] delete属性

#### 4.2 自定义元素
- [ ] 索引访问
- [ ] insert操作
- [ ] delete操作

### 第五阶段：高级特性

优先级：⭐⭐

#### 5.1 原始嵌入
- [ ] `[Origin] @Html`
- [ ] `[Origin] @Style`
- [ ] `[Origin] @JavaScript`
- [ ] 带名原始嵌入

#### 5.2 导入系统
- [ ] 导入CHTL文件
- [ ] 导入HTML/CSS/JS
- [ ] 路径搜索

#### 5.3 命名空间
- [ ] 创建命名空间
- [ ] 嵌套命名空间
- [ ] from语法

#### 5.4 约束系统
- [ ] 精确约束
- [ ] 类型约束
- [ ] 全局约束

#### 5.5 配置组
- [ ] 基础配置
- [ ] Name配置块
- [ ] 自定义关键字

### 第六阶段：CHTL JS

优先级：⭐⭐⭐⭐

#### 6.1 基础架构
- [ ] 独立的Lexer
- [ ] 独立的Parser
- [ ] 独立的Generator
- [ ] 与CHTL通过盐桥通信

#### 6.2 脚本系统
- [ ] 局部script块
- [ ] 增强选择器 `{{}}`
- [ ] 自动化规则

#### 6.3 事件系统
- [ ] Listen声明式监听
- [ ] `&->` 事件绑定操作符
- [ ] Delegate事件委托

#### 6.4 动画系统
- [ ] Animate函数
- [ ] 缓动函数
- [ ] 关键帧

#### 6.5 高级特性
- [ ] Vir虚对象
- [ ] Router路由
- [ ] 响应式值 `$var$`

### 第七阶段：模块系统

优先级：⭐⭐

#### 7.1 CMOD
- [ ] 模块结构
- [ ] 模块信息
- [ ] 打包/解包

#### 7.2 CJMOD
- [ ] 模块结构
- [ ] CJMOD API
- [ ] 语法扩展

#### 7.3 官方模块
- [ ] Chtholly模块
- [ ] Yuigahama模块

### 第八阶段：工具链

优先级：⭐

#### 8.1 CLI工具
- [ ] 常规命令行
- [ ] 图形化CLI
- [ ] 编译监视器

#### 8.2 IDE支持
- [ ] VSCode扩展
- [ ] 语法高亮
- [ ] 代码提示
- [ ] 实时预览

### 第九阶段：自举

优先级：⭐

- [ ] 使用Chtholly重写编译器
- [ ] 性能优化
- [ ] 完整文档

## 当前进度

### 已完成 ✅
- [x] 项目架构（状态机+策略模式）
- [x] 构建系统（CMake + Python）
- [x] 版本控制（.gitignore）
- [x] 基础Lexer（Token识别）
- [x] AST基础框架
- [x] 盐桥机制
- [x] 基础测试框架

### 进行中 🚧
- [ ] 完善Lexer（生成器注释、无修饰字面量）
- [ ] 实现Parser（元素解析、属性解析）
- [ ] 实现Generator（HTML生成）

### 待开始 📋
- 所有高级特性

## 每周目标

### Week 1: 基础语法完善
- 完善注释系统
- 完善文本节点
- 完善元素解析（嵌套+属性）
- 确保基础HTML生成正确

### Week 2: 样式系统
- 内联样式
- 自动化类名/ID
- 基础属性运算

### Week 3-4: 模板系统
- 样式组模板
- 元素模板
- 变量组模板
- 继承系统

### Week 5-6: 自定义系统
- 自定义样式组
- 自定义元素
- 特例化操作

### Week 7-8: CHTL JS基础
- 独立编译器架构
- 局部script
- 增强选择器
- 基础事件系统

## 质量标准

每个功能必须满足：

1. **测试覆盖率**: 核心功能100%覆盖
2. **文档完整性**: 每个功能都有使用示例
3. **错误处理**: 优雅的错误提示
4. **性能要求**: 不明显的性能问题
5. **代码质量**: 通过所有编译器警告

## 测试策略

### 单元测试
- 每个功能都有对应的单元测试
- 测试正常情况和边界情况
- 测试错误处理

### 集成测试
- 完整的CHTL文件编译测试
- 生成的HTML/CSS/JS正确性验证

### 回归测试
- 新功能不能破坏已有功能
- 保持所有测试通过

## 注意事项

1. **不要急于求成**: 一个功能一个功能来
2. **保持稳定**: 确保每次提交都能编译通过
3. **写好测试**: 测试先行，实现在后
4. **及时重构**: 发现问题及时重构
5. **文档同步**: 代码和文档保持同步

## 长期目标

1. 完成Chtholly.md中的所有特性
2. 使用Chtholly自举编写编译器
3. 建立完整的工具链
4. 创建示例项目
5. 编写完整的教程

---

**当前阶段**: 第一阶段 - 基础语法  
**下一个里程碑**: 完成基础元素解析和HTML生成  
**预计完成时间**: 根据实际进度调整
