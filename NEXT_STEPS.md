# CHTL项目下一步开发计划

**日期**: 2025-10-06  
**当前版本**: v0.2.0-alpha  
**目标版本**: v0.3.0-beta

## 🎯 核心目标

将CHTL编译器从**可用状态**提升到**生产就绪状态**，重点实现CHTL JS和高级特性。

## 📋 优先级路线图

### 阶段1：完善核心功能（1-2周）

#### 1.1 CSS生成增强 ⭐⭐⭐⭐⭐
**重要性**: 非常高  
**难度**: 中  
**预计时间**: 3-4天

**任务**:
- [ ] 实现属性运算（width: 100px + 50px）
- [ ] 实现属性条件表达式（width > 50px ? ... : ...）
- [ ] 实现引用属性（box.width）
- [ ] 优化CSS输出格式
- [ ] 支持CSS单位处理

**测试要求**:
- 10+个属性运算测试用例
- 5+个条件表达式测试用例
- 边界情况测试

**成功标准**:
```chtl
div {
    style {
        width: 100px + 50px;  // 生成: width: 150px;
        height: width > 100px ? 200px : 100px;  // 条件表达式
    }
}
```

#### 1.2 JavaScript生成优化 ⭐⭐⭐⭐
**重要性**: 高  
**难度**: 中  
**预计时间**: 2-3天

**任务**:
- [ ] 局部脚本块处理
- [ ] 脚本合并和去重
- [ ] 作用域管理
- [ ] 脚本依赖分析

**测试要求**:
- 局部脚本测试
- 作用域隔离测试

#### 1.3 错误处理增强 ⭐⭐⭐
**重要性**: 中高  
**难度**: 低  
**预计时间**: 2天

**任务**:
- [ ] 更友好的错误消息
- [ ] 错误位置可视化
- [ ] 建议修复提示
- [ ] 警告系统

### 阶段2：CHTL JS实现（2-3周）

#### 2.1 CHTL JS词法分析器 ⭐⭐⭐⭐⭐
**重要性**: 非常高  
**难度**: 中高  
**预计时间**: 4-5天

**任务**:
- [ ] CHTLJSLexer基础实现
- [ ] CHTL JS Token类型定义
- [ ] 增强选择器 {{...}} 识别
- [ ] 特殊运算符识别（->、&->）
- [ ] 声明式语法识别

**文件结构**:
```
src/CHTL-JS/
├── CHTLJSLexer/
│   ├── Token.h/cpp
│   ├── Lexer.h/cpp
│   └── GlobalMap.h/cpp
```

#### 2.2 增强选择器实现 ⭐⭐⭐⭐⭐
**重要性**: 非常高  
**难度**: 中  
**预计时间**: 3-4天

**任务**:
- [ ] {{selector}} 解析
- [ ] CSS选择器转JavaScript代码
- [ ] querySelector/querySelectorAll生成
- [ ] & 引用解析

**成功标准**:
```chtl
script {
    {{.box}}.textContent = "Hello";
    // 生成: document.querySelector('.box').textContent = "Hello";
    
    {{&}}->addEventListener('click', handler);
    // 根据上下文生成相应代码
}
```

#### 2.3 基础CHTL JS语法 ⭐⭐⭐⭐
**重要性**: 高  
**难度**: 中高  
**预计时间**: 5-6天

**任务**:
- [ ] Listen语法解析和生成
- [ ] Delegate语法解析和生成
- [ ] 事件绑定操作符 &->
- [ ] 声明式函数调用

**示例**:
```chtl
script {
    {{box}}->Listen {
        click: () => { ... },
        mouseenter: handler
    };
    
    {{box}} &-> click: handler;
}
```

#### 2.4 盐桥机制基础 ⭐⭐⭐⭐⭐
**重要性**: 非常高  
**难度**: 高  
**预计时间**: 4-5天

**任务**:
- [ ] SharedCore架构设计
- [ ] CHTL与CHTL JS通信协议
- [ ] 上下文共享机制
- [ ] {{&}} 引用解析

**关键点**:
- CHTL Parser需要识别script块中的CHTL JS语法
- CHTL JS Parser需要能够访问CHTL的上下文信息
- 双向通信机制

### 阶段3：高级特性（3-4周）

#### 3.1 模板系统 ⭐⭐⭐⭐
**重要性**: 高  
**难度**: 中高  
**预计时间**: 5-6天

**任务**:
- [ ] 模板定义解析
- [ ] 模板使用和展开
- [ ] 模板继承（inherit）
- [ ] 样式组模板
- [ ] 元素模板
- [ ] 变量组模板

**示例**:
```chtl
[Template] @Style DefaultText {
    color: "black";
    line-height: 1.6;
}

div {
    style {
        @Style DefaultText;  // 使用模板
    }
}
```

#### 3.2 自定义系统 ⭐⭐⭐⭐
**重要性**: 高  
**难度**: 高  
**预计时间**: 6-7天

**任务**:
- [ ] 自定义定义解析
- [ ] 无值样式组
- [ ] 特例化操作（delete、insert）
- [ ] 索引访问
- [ ] 元素模板增强

**示例**:
```chtl
[Custom] @Style TextSet {
    color,    // 无值
    font-size;
}

[Custom] @Element Box {
    div {}
    div {}
    span {}
}

// 使用
@Element Box {
    div[1] {  // 索引访问
        style { ... }
    }
    
    insert after div[0] {  // 插入
        p { text: "New content"; }
    }
}
```

#### 3.3 更多CHTL JS语法 ⭐⭐⭐
**重要性**: 中高  
**难度**: 高  
**预计时间**: 7-8天

**任务**:
- [ ] Animate语法
- [ ] Router语法
- [ ] ScriptLoader
- [ ] 虚对象Vir
- [ ] util...end表达式

### 阶段4：模块系统（1-2个月）

#### 4.1 CMOD系统 ⭐⭐⭐
**任务**:
- [ ] 模块结构定义
- [ ] Info和Export解析
- [ ] 模块打包工具
- [ ] 模块加载器

#### 4.2 CJMOD系统 ⭐⭐⭐
**任务**:
- [ ] CJMOD API设计
- [ ] 语法分析（Syntax::analyze）
- [ ] 参数绑定（Arg::bind）
- [ ] 代码生成

#### 4.3 官方模块 ⭐⭐
**任务**:
- [ ] Chtholly模块
- [ ] Yuigahama模块

### 阶段5：生态系统（2-3个月）

#### 5.1 VSCode扩展
- [ ] 语法高亮
- [ ] 代码补全
- [ ] 实时预览
- [ ] 错误提示

#### 5.2 外部编译器集成
- [ ] CSS编译器（libcss/sassc）
- [ ] JavaScript编译器（V8/QuickJS）

## 🚀 即刻开始的任务

### 第一周任务清单

#### Day 1-2: CSS生成增强
1. 实现基础属性运算
2. 编写测试用例
3. 文档更新

#### Day 3-4: JavaScript生成
1. 局部脚本处理
2. 脚本合并
3. 测试

#### Day 5-7: CHTL JS词法分析器
1. Token类型定义
2. Lexer实现
3. 增强选择器识别
4. 测试

### 关键里程碑

- **Week 2**: CSS和JS生成完善 ✓
- **Week 4**: CHTL JS基础语法完成 ✓
- **Week 6**: 盐桥机制实现 ✓
- **Week 8**: 模板系统完成 ✓
- **Week 10**: 自定义系统完成 ✓
- **Month 3**: CMOD系统完成 ✓
- **Month 4**: CJMOD系统完成 ✓
- **Month 6**: VSCode扩展发布 ✓

## 📊 成功指标

### 技术指标
- [ ] 代码覆盖率 > 80%
- [ ] 所有测试通过率 100%
- [ ] 编译时间 < 1秒（小型项目）
- [ ] 内存使用 < 100MB

### 功能指标
- [ ] 支持CHTL.md中定义的所有语法
- [ ] 能够编译实际项目
- [ ] 生成的代码符合Web标准
- [ ] 支持Source Map

### 质量指标
- [ ] 友好的错误提示
- [ ] 完整的文档
- [ ] 丰富的示例
- [ ] 活跃的社区

## 💡 实施建议

### 1. 持续TDD
- 每个新特性都先写测试
- 保持测试通过率100%
- 添加集成测试

### 2. 文档先行
- 先设计API
- 编写使用文档
- 再实现功能

### 3. 小步迭代
- 每次只实现一个小特性
- 及时提交代码
- 避免大改动

### 4. 性能优化
- 使用性能分析工具
- 优化热点代码
- 减少内存分配

### 5. 代码审查
- 保持代码质量
- 遵循编码规范
- 重构改进

## 🎯 最终目标

创建一个**生产就绪**的CHTL编译器：

- ✅ 完整的CHTL语法支持
- ✅ 完整的CHTL JS支持
- ✅ 模块系统
- ✅ 优秀的错误处理
- ✅ 丰富的生态系统
- ✅ 详细的文档
- ✅ 活跃的社区

让CHTL成为Web开发的**新选择**！🚀
