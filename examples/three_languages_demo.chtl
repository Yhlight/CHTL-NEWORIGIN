// CHTL v2.5.0 - ä¸‰è¯­è¨€å…±å­˜å®Œæ•´ç¤ºä¾‹
// å±•ç¤º CHTL + CHTL JS + JavaScript å¦‚ä½•å’Œè°å·¥ä½œ

use html5;

[Import] @Chtl from chtl::Chtholly
[Import] @Chtl from chtl::Yuigahama

html
{
    head
    {
        title
        {
            text: "CHTL ä¸‰è¯­è¨€å…±å­˜ç¤ºä¾‹";
        }
        
        style
        {
            // å…¨å±€æ ·å¼ - CHTL è¯­è¨€
            * {
                margin: 0;
                padding: 0;
                box-sizing: border-box;
            }
        }
    }
    
    body
    {
        // CHTL è¯­è¨€ - ç»“æ„å®šä¹‰
        style
        {
            @Style ChthollyTheme;
        }
        
        @Element ChthollyPage
        {
            // æ ‡é¢˜å¡ç‰‡
            div
            {
                style
                {
                    @Style ChthollyCard;
                    text-align: center;
                    margin-bottom: ChthollySpacing(xl);
                }
                
                h1
                {
                    text: "ä¸‰è¯­è¨€ååŒå·¥ä½œç¤ºä¾‹";
                    
                    style
                    {
                        color: ChthollyColors(primaryDark);
                        font-size: ChthollyFonts(size3xl);
                    }
                }
                
                p
                {
                    text: "å±•ç¤º CHTL + CHTL JS + JavaScript çš„å®Œç¾é…åˆ";
                    
                    style
                    {
                        color: ChthollyColors(textSecondary);
                    }
                }
            }
            
            // è®¡æ•°å™¨ç¤ºä¾‹
            div
            {
                style
                {
                    @Style YuigahamaCard;
                    margin-bottom: YuigahamaSpacing(lg);
                }
                
                h2
                {
                    text: "1. è®¡æ•°å™¨ç¤ºä¾‹";
                    style { color: YuigahamaColors(primary); }
                }
                
                div
                {
                    id: counter-display;
                    text: "0";
                    
                    style
                    {
                        font-size: 48px;
                        font-weight: bold;
                        text-align: center;
                        margin: YuigahamaSpacing(lg) 0;
                        color: YuigahamaColors(primaryDark);
                    }
                }
                
                div
                {
                    style
                    {
                        display: flex;
                        gap: YuigahamaSpacing(md);
                        justify-content: center;
                    }
                    
                    button
                    {
                        class: dec-btn;
                        text: "-1";
                        style { @Style YuigahamaButton; }
                    }
                    
                    button
                    {
                        class: reset-btn;
                        text: "é‡ç½®";
                        style { @Style ChthollyButton; }
                    }
                    
                    button
                    {
                        class: inc-btn;
                        text: "+1";
                        style { @Style YuigahamaButton; }
                    }
                }
                
                script
                {
                    // ========================================
                    // JavaScript éƒ¨åˆ† - æ•°æ®æ¨¡å‹å’Œä¸šåŠ¡é€»è¾‘
                    // ========================================
                    
                    // çŠ¶æ€ç®¡ç†ï¼ˆçº¯ JSï¼‰
                    const counterState = {
                        count: 0,
                        min: 0,
                        max: 100,
                        history: []
                    };
                    
                    // ä¸šåŠ¡é€»è¾‘å‡½æ•°ï¼ˆçº¯ JSï¼‰
                    function increment() {
                        if (counterState.count < counterState.max) {
                            counterState.count++;
                            counterState.history.push({
                                action: 'increment',
                                value: counterState.count,
                                timestamp: Date.now()
                            });
                            return true;
                        }
                        return false;
                    }
                    
                    function decrement() {
                        if (counterState.count > counterState.min) {
                            counterState.count--;
                            counterState.history.push({
                                action: 'decrement',
                                value: counterState.count,
                                timestamp: Date.now()
                            });
                            return true;
                        }
                        return false;
                    }
                    
                    function reset() {
                        counterState.count = 0;
                        counterState.history = [];
                    }
                    
                    // å·¥å…·å‡½æ•°ï¼ˆçº¯ JSï¼‰
                    const formatNumber = (num) => {
                        return num.toString().padStart(3, '0');
                    };
                    
                    const updateDisplay = () => {
                        const displayText = formatNumber(counterState.count);
                        {{#counter-display}}->textContent = displayText;
                    };
                    
                    // ========================================
                    // CHTL JS éƒ¨åˆ† - DOM é€‰æ‹©
                    // ========================================
                    
                    const display = {{#counter-display}};
                    const incBtn = {{.inc-btn}};
                    const decBtn = {{.dec-btn}};
                    const resetBtn = {{.reset-btn}};
                    
                    // ========================================
                    // æ··åˆéƒ¨åˆ† - CHTL JS äº‹ä»¶ç»‘å®š + JS é€»è¾‘
                    // ========================================
                    
                    incBtn &-> click: () => {
                        if (increment()) {
                            updateDisplay();
                            console.log('Incremented to:', counterState.count);
                        } else {
                            alert('å·²è¾¾åˆ°æœ€å¤§å€¼ï¼');
                        }
                    };
                    
                    decBtn &-> click: () => {
                        if (decrement()) {
                            updateDisplay();
                        } else {
                            alert('å·²è¾¾åˆ°æœ€å°å€¼ï¼');
                        }
                    };
                    
                    resetBtn->Listen {
                        click: () => {
                            reset();
                            updateDisplay();
                            console.log('Counter reset');
                        }
                    };
                    
                    // ========================================
                    // JavaScript éƒ¨åˆ† - åˆå§‹åŒ–
                    // ========================================
                    
                    updateDisplay();
                }
            }
            
            // éŸ³ä¹æ’­æ”¾å™¨ç¤ºä¾‹
            div
            {
                style
                {
                    @Style YuigahamaCard;
                    margin-bottom: YuigahamaSpacing(lg);
                }
                
                h2
                {
                    text: "2. éŸ³ä¹æ’­æ”¾å™¨ç¤ºä¾‹";
                    style { color: YuigahamaColors(primary); }
                }
                
                @Element YuigahaMusicPlayerWidget
                {
                    script
                    {
                        // ========================================
                        // JavaScript éƒ¨åˆ† - éŸ³ä¹æ•°æ®å’Œé€»è¾‘
                        // ========================================
                        
                        // æ’­æ”¾åˆ—è¡¨ï¼ˆçº¯ JS æ•°ç»„ï¼‰
                        const playlist = [
                            {
                                title: 'Scarborough Fair',
                                artist: 'èæ‹‰Â·å¸ƒè±æ›¼',
                                duration: 245,
                                cover: 'cover1.jpg'
                            },
                            {
                                title: 'Always With Me',
                                artist: 'æœ¨æ‘å¼“',
                                duration: 198,
                                cover: 'cover2.jpg'
                            }
                        ];
                        
                        // æ’­æ”¾å™¨çŠ¶æ€ï¼ˆçº¯ JS å¯¹è±¡ï¼‰
                        const playerState = {
                            currentIndex: 0,
                            isPlaying: false,
                            currentTime: 0,
                            volume: 0.8
                        };
                        
                        // æ’­æ”¾å™¨é€»è¾‘ï¼ˆçº¯ JS å‡½æ•°ï¼‰
                        function loadSong(index) {
                            if (index >= 0 && index < playlist.length) {
                                playerState.currentIndex = index;
                                const song = playlist[index];
                                return song;
                            }
                            return null;
                        }
                        
                        function togglePlay() {
                            playerState.isPlaying = !playerState.isPlaying;
                            return playerState.isPlaying;
                        }
                        
                        function nextSong() {
                            const nextIndex = (playerState.currentIndex + 1) % playlist.length;
                            return loadSong(nextIndex);
                        }
                        
                        function prevSong() {
                            const prevIndex = playerState.currentIndex - 1;
                            const index = prevIndex < 0 ? playlist.length - 1 : prevIndex;
                            return loadSong(index);
                        }
                        
                        // ========================================
                        // CHTL JS éƒ¨åˆ† - DOM é€‰æ‹©
                        // ========================================
                        
                        const songTitle = {{.song-title}};
                        const songArtist = {{.song-artist}};
                        const playBtn = {{.play-btn}};
                        const prevBtn = {{.prev-btn}};
                        const nextBtn = {{.next-btn}};
                        const progressBar = {{.progress-fill}};
                        
                        // ========================================
                        // æ··åˆéƒ¨åˆ† - äº‹ä»¶å¤„ç†
                        // ========================================
                        
                        // æ›´æ–°UIï¼ˆæ··åˆ JS é€»è¾‘ + CHTL JS DOMæ“ä½œï¼‰
                        function updateUI() {
                            const song = playlist[playerState.currentIndex];
                            songTitle->textContent = song.title;
                            songArtist->textContent = song.artist;
                        }
                        
                        // CHTL JS äº‹ä»¶ç»‘å®š
                        playBtn &-> click: () => {
                            const playing = togglePlay();  // JS å‡½æ•°
                            playBtn->textContent = playing ? 'â¸' : 'â–¶';  // CHTL JS
                            console.log(playing ? 'Playing' : 'Paused');  // JS
                        };
                        
                        nextBtn &-> click: () => {
                            const song = nextSong();  // JS å‡½æ•°
                            if (song) {
                                updateUI();  // JS å‡½æ•°
                                console.log('Next song:', song.title);  // JS
                            }
                        };
                        
                        prevBtn &-> click: () => {
                            const song = prevSong();
                            if (song) {
                                updateUI();
                            }
                        };
                        
                        // ========================================
                        // JavaScript éƒ¨åˆ† - åˆå§‹åŒ–å’Œå®šæ—¶å™¨
                        // ========================================
                        
                        // åˆå§‹åŒ–
                        const initSong = loadSong(0);
                        if (initSong) {
                            updateUI();
                        }
                        
                        // æ¨¡æ‹Ÿæ’­æ”¾è¿›åº¦ï¼ˆçº¯ JS å®šæ—¶å™¨ï¼‰
                        setInterval(() => {
                            if (playerState.isPlaying) {
                                playerState.currentTime++;
                                const song = playlist[playerState.currentIndex];
                                const progress = (playerState.currentTime / song.duration) * 100;
                                
                                // CHTL JS æ›´æ–°è¿›åº¦æ¡
                                progressBar->style.width = progress + '%';
                                
                                // è‡ªåŠ¨ä¸‹ä¸€é¦–
                                if (playerState.currentTime >= song.duration) {
                                    playerState.currentTime = 0;
                                    nextSong();
                                    updateUI();
                                }
                            }
                        }, 1000);
                    }
                }
            }
            
            // API äº¤äº’ç¤ºä¾‹
            div
            {
                style
                {
                    @Style ChthollyCard;
                }
                
                h2
                {
                    text: "3. API äº¤äº’ç¤ºä¾‹";
                    style { color: ChthollyColors(primary); }
                }
                
                div
                {
                    id: api-result;
                    text: "ç‚¹å‡»æŒ‰é’®åŠ è½½æ•°æ®...";
                }
                
                button
                {
                    class: load-btn;
                    text: "åŠ è½½æ•°æ®";
                    style { @Style ChthollyButton; }
                }
                
                script
                {
                    // JavaScript éƒ¨åˆ† - API è°ƒç”¨
                    async function fetchUserData() {
                        try {
                            // æ¨¡æ‹Ÿ API è°ƒç”¨
                            return new Promise((resolve) => {
                                setTimeout(() => {
                                    resolve({
                                        users: [
                                            { id: 1, name: 'ç‚æœµè‰' },
                                            { id: 2, name: 'ç”±æ¯”æ»¨ç»“è¡£' }
                                        ]
                                    });
                                }, 1000);
                            });
                        } catch (error) {
                            console.error('Failed to fetch:', error);
                            return null;
                        }
                    }
                    
                    // CHTL JS éƒ¨åˆ† - DOM é€‰æ‹©
                    const resultDiv = {{#api-result}};
                    const loadBtn = {{.load-btn}};
                    
                    // æ··åˆéƒ¨åˆ† - äº‹ä»¶å¤„ç†
                    loadBtn &-> click: async () => {
                        // CHTL JS æ›´æ–°UI
                        resultDiv->textContent = 'åŠ è½½ä¸­...';
                        loadBtn->disabled = true;
                        
                        // JS å¼‚æ­¥è°ƒç”¨
                        const data = await fetchUserData();
                        
                        if (data && data.users) {
                            // JS æ•°æ®å¤„ç†
                            const userList = data.users
                                .map(u => `<div>${u.id}. ${u.name}</div>`)
                                .join('');
                            
                            // CHTL JS DOM æ›´æ–°
                            resultDiv->innerHTML = userList;
                        }
                        
                        // CHTL JS æ¢å¤æŒ‰é’®
                        loadBtn->disabled = false;
                    };
                }
            }
        }
        
        // å…¨å±€è„šæœ¬
        script
        {
            // ========================================
            // JavaScript éƒ¨åˆ† - å…¨å±€å·¥å…·
            // ========================================
            
            // å·¥å…·å¯¹è±¡
            const Utils = {
                formatDate: (timestamp) => {
                    return new Date(timestamp).toLocaleString('zh-CN');
                },
                
                debounce: (fn, delay) => {
                    let timer;
                    return (...args) => {
                        clearTimeout(timer);
                        timer = setTimeout(() => fn(...args), delay);
                    };
                },
                
                throttle: (fn, limit) => {
                    let inThrottle;
                    return (...args) => {
                        if (!inThrottle) {
                            fn(...args);
                            inThrottle = true;
                            setTimeout(() => inThrottle = false, limit);
                        }
                    };
                }
            };
            
            // å…¨å±€çŠ¶æ€ç®¡ç†
            window.AppState = {
                initialized: false,
                theme: 'chtholly',
                language: 'zh-CN'
            };
            
            // ========================================
            // æ··åˆéƒ¨åˆ† - å…¨å±€äº‹ä»¶ç›‘å¬
            // ========================================
            
            // é¡µé¢åŠ è½½å®Œæˆ
            document.addEventListener('DOMContentLoaded', () => {
                console.log('é¡µé¢åŠ è½½å®Œæˆ');
                console.log('æ”¯æŒçš„è¯­è¨€ï¼šCHTL + CHTL JS + JavaScript');
                
                window.AppState.initialized = true;
                
                // ä½¿ç”¨ CHTL JS
                console.log('ç‚æœµè‰æ¨¡å—ï¼šå·²åŠ è½½ ğŸŒ¸');
                console.log('ç”±æ¯”æ»¨æ¨¡å—ï¼šå·²åŠ è½½ ğŸŒŸ');
            });
            
            // ========================================
            // JavaScript éƒ¨åˆ† - æ€§èƒ½ç›‘æ§
            // ========================================
            
            // æ€§èƒ½ç›‘æ§
            window.addEventListener('load', () => {
                const perfData = performance.getEntriesByType('navigation')[0];
                console.log('é¡µé¢åŠ è½½æ—¶é—´:', perfData.loadEventEnd - perfData.fetchStart, 'ms');
            });
            
            // ========================================
            // CHTL JS éƒ¨åˆ† - å…¨å±€é¼ æ ‡ç‰¹æ•ˆ
            // ========================================
            
            // åˆ›å»ºé¼ æ ‡ç‰¹æ•ˆå…ƒç´ 
            const mouseEffect = document.createElement('div');
            mouseEffect.className = 'mouse-effect';
            mouseEffect.style.cssText = `
                position: fixed;
                width: 20px;
                height: 20px;
                background: #FFB6C1;
                border-radius: 50%;
                pointer-events: none;
                opacity: 0.6;
                transition: all 0.1s ease;
                z-index: 9999;
            `;
            document.body.appendChild(mouseEffect);
            
            // é¼ æ ‡ç§»åŠ¨ï¼ˆçº¯ JS äº‹ä»¶ï¼‰
            document.addEventListener('mousemove', (e) => {
                mouseEffect.style.left = (e.clientX - 10) + 'px';
                mouseEffect.style.top = (e.clientY - 10) + 'px';
            });
            
            console.log('ğŸ‰ CHTL v2.5.0 ä¸‰è¯­è¨€ç³»ç»Ÿåˆå§‹åŒ–å®Œæˆï¼');
        }
    }
}
